<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Order Tagging</title>
<style>
/* ===== Professional Theme ===== */
:root{--bg: #f6f8fb;--surface: #ffffff;--surface-2:#f3f6fb;--text: #0f172a;--muted: #64748b;--border: #e2e8f0;--primary: #1d4ed8;--primary-hover:#1e40af;--primary-soft:#eff6ff;--shadow: 0 10px 30px rgba(15, 23, 42, 0.08);--radius: 12px;--radius-sm: 10px;--mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;--sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;padding:28px 18px;font-family: var(--sans);background: radial-gradient(1200px 600px at 20% 0%, #eef2ff 0%, rgba(238,242,255,0) 60%),radial-gradient(1200px 600px at 80% 0%, #ecfeff 0%, rgba(236,254,255,0) 55%),var(--bg);color: var(--text);display:flex;justify-content:center;align-items:flex-start;}
.wrapper{max-width:1100px;width:100%}
.header{display:flex;justify-content:space-between;align-items:flex-end;gap:16px;margin:6px 0 18px;padding:2px 2px 10px;border-bottom:1px solid var(--border);}
.header h1{margin:0;font-size:20px;letter-spacing:.2px;font-weight:700;}
.byline{font-size:13px;color: var(--muted);font-style:normal;}
.card{background: var(--surface);border: 1px solid var(--border);border-radius: var(--radius);box-shadow: var(--shadow);padding:18px;margin-bottom:16px;}
.card h3{margin:0 0 10px;font-size:14px;font-weight:700;color: var(--text);letter-spacing:.2px;}
textarea{width:100%;height:150px;padding:12px 12px;font-family: var(--mono);font-size:13px;line-height:1.45;border:1px solid var(--border);border-radius: var(--radius-sm);resize:vertical;background: linear-gradient(180deg, #ffffff, #fbfdff);outline:none;transition: box-shadow .15s ease, border-color .15s ease;}
textarea:focus{border-color: rgba(29,78,216,.45);box-shadow: 0 0 0 4px rgba(29,78,216,.12);}
.buttons{display:flex;gap:10px;margin:12px 0 0}
button{padding:10px 12px;font-size:13px;font-weight:700;color:#fff;background: var(--primary);border:1px solid rgba(0,0,0,0);border-radius: 10px;cursor:pointer;transition: transform .05s ease, background .15s ease, box-shadow .15s ease;box-shadow: 0 6px 14px rgba(29,78,216,.18);}
button:hover{background: var(--primary-hover)}
button:active{transform: translateY(1px)}
button:focus-visible{outline:none;box-shadow: 0 0 0 4px rgba(29,78,216,.18), 0 6px 14px rgba(29,78,216,.18);}
.container{display:grid;grid-template-columns:2fr 1fr;gap:16px}
.output-card{display:flex;flex-direction:column;position:relative}
.output-card h3{margin:0 0 10px;padding-right: 120px;}
.copy-btn{position:absolute;top: 9px;right: 18.5px;margin:0;padding:8px 10px;font-size:12px;font-weight:700;background: #0f172a;box-shadow:none;}
.copy-btn:hover{background:#111c33}
#output,#ordersOutput{flex:1;overflow:auto;white-space:pre-wrap;background: var(--surface-2);padding:14px;border:1px solid var(--border);border-radius: var(--radius-sm);font-family: var(--mono);font-size:13px;color: var(--text);min-height:200px;}
#total{text-align:left;font-size:13px;margin:10px 0 12px;color: var(--muted);font-weight:600;}
.alert{border-radius: var(--radius);padding:12px 14px;margin:0 0 10px;display:none;position:relative;border:1px solid var(--border);box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06);animation:fadeIn .12s ease-out;}
.alert[data-visible=true]{display:block}
.alert .alert-head{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:8px;}
.alert .title{font-weight:800;letter-spacing:.1px}
.alert .subtitle{font-size:12px;color: var(--muted)}
.alert .badge{display:inline-flex;align-items:center;justify-content:center;min-width:22px;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:800;background: rgba(15, 23, 42, .06);}
.alert .actions{margin-left:auto;display:flex;gap:8px;align-items:center;}
.alert .actions button{background: transparent;color: inherit;border: 1px solid currentColor;padding:6px 10px;border-radius: 10px;font-size:12px;font-weight:800;cursor:pointer;box-shadow:none;}
.alert .actions button:hover{opacity:.92}
.alert .list{margin:0;font-family: var(--mono);font-size:13px;line-height:1.55;white-space:normal;word-break:break-word;color: var(--text);}
.alert .list.collapsed{max-height:64px;overflow:hidden;position:relative;}
.alert .list.collapsed::after{content:"";position:absolute;left:0;right:0;bottom:0;height:26px;background: linear-gradient(to bottom, rgba(243,246,251,0), rgba(243,246,251,.95));}
.alert .toggle{display:inline-block;margin-top:8px;font-size:12px;font-weight:700;color: var(--primary);cursor:pointer;text-decoration:none;}
.alert .toggle:hover{text-decoration:underline}
#mm-alert, #removed-alert{background: #fff7ed;border-color: #fed7aa;color: #7c2d12;}
#pair-plx-alert{background: #fef2f2;border-color: #fecaca;color: #7f1d1d;}
@keyframes fadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
@media(max-width:900px){.container{grid-template-columns:1fr}.header{align-items:flex-start}}
</style>
</head><body>
<div class="wrapper">
  <div class="header"><h1>Order Tagging</h1><div class="byline">By: Christine Anastacio</div></div>
  <div class="card"><h3>Input</h3>
    <textarea id="input" placeholder="Paste data: Order Number âŸ¶ SKU âŸ¶ Golden SKU"></textarea>
    <div class="buttons"><button onclick="formatOrders()">Format</button><button onclick="resetAll()">Reset</button></div>
  </div>
  <div id="mm-alert" class="alert"></div>
  <div id="removed-alert" class="alert"></div>
  <div id="pair-plx-alert" class="alert"></div>
  <div id="total">Total Orders: 0</div>
  <div class="container">
    <div class="card output-card"><h3>Formatted Output</h3><button id="copyFormattedBtn" class="copy-btn" onclick="copyOutput()">Copy</button><div id="output"></div></div>
    <div class="card output-card"><h3>Order Numbers</h3><button id="copyOrdersBtn" class="copy-btn" onclick="copyOrders()">Copy</button><div id="ordersOutput"></div></div>
  </div>
</div>
<script>
let lastOrders=[];
const META_RX = /^(PLX|CLX|KLX|LLX|MLX|DLX|OLX|TLX|GEN|WLX|FBA|SLX)-/i, HAS_PAIR_RX = /(?:^|-)PAIR(?:-|$)/i;
const copyTextSafe=t=>navigator.clipboard&&isSecureContext?navigator.clipboard.writeText(t).catch(()=>legacyCopy(t)):legacyCopy(t);
function legacyCopy(t){const a=document.createElement("textarea");a.value=t;a.style.position="fixed";a.style.left="-9999px";document.body.appendChild(a);a.focus();a.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(a)}
function renderAlert(id,o={}){const el=document.getElementById(id);if(!el)return;const{title="Notice",subtitle="",items=[],previewCount=5,copyLabel="Copy"}=o;const u=[...new Set(items.filter(Boolean))].sort((a,b)=>a.localeCompare(b,undefined,{numeric:true,sensitivity:"base"}));if(!u.length){el.dataset.visible="false";el.style.display="none";el.innerHTML="";return}const total=u.length,collapsed=total>previewCount,idsText=u.join(", ");el.setAttribute("role","alert");el.setAttribute("aria-live","polite");el.dataset.visible="true";el.style.display="block";el.innerHTML=`<div class="alert-head"><span class="title">${title}</span><span class="badge" aria-label="count">${total}</span><span class="subtitle">${subtitle}</span><div class="actions"><button type="button" data-action="copy">${copyLabel}</button><button type="button" data-action="dismiss" aria-label="Dismiss">Hide</button></div></div><div class="list ${collapsed?"collapsed":""}" data-role="list">${idsText}</div>${collapsed?`<a class="toggle" href="#" data-action="toggle">Show all ${total}</a>`:""}`;el.querySelector('[data-action="copy"]')?.addEventListener("click",e=>{e.preventDefault();copyTextSafe(u.join("\r\n"));e.target.textContent="Copied!";setTimeout(()=>e.target.textContent=copyLabel,700)});el.querySelector('[data-action="dismiss"]')?.addEventListener("click",e=>{e.preventDefault();el.dataset.visible="false";el.style.display="none"});el.querySelector('[data-action="toggle"]')?.addEventListener("click",e=>{e.preventDefault();const l=el.querySelector('[data-role="list"]');const c=l.classList.toggle("collapsed");e.target.textContent=c?`Show all ${total}`:"Show less"})}
function formatOrders(){
  const rawLines=document.getElementById("input").value.split("\n").map(l=>l.replace(/\r/g,""));
  const results=[];let cur=[],ignore=false;
  const mmOrders=[],removed=[],pairPlxOne=[];
  const metaByOrder=new Map(); // order -> {plx:boolean,pair:boolean}
  const markMeta=(order,metaTokens)=>{if(!order||!metaTokens?.length)return;const m=metaByOrder.get(order)||{plx:false,pair:false};metaTokens.forEach(t=>{if(META_RX.test(t)){if(/^PLX-/i.test(t))m.plx=true;if(HAS_PAIR_RX.test(t))m.pair=true}else if(HAS_PAIR_RX.test(t)){m.pair=true}});metaByOrder.set(order,m)};
  for(let lr of rawLines){
    if(!lr)continue;
    const isCont=/^\s/.test(lr);
    const line=lr.trim(); if(!line)continue;
    let tokens=line.includes(";")?line.split(";").map(t=>t.trim()).filter(Boolean):line.split(/\s+/).filter(Boolean);
    const metaTokens=tokens.filter(t=>META_RX.test(t)||HAS_PAIR_RX.test(t));
    tokens=tokens.filter(t=>!META_RX.test(t)&&!HAS_PAIR_RX.test(t)); // strip meta from SKU stream
    if(!isCont && tokens.length>1){ // new order row
      if(cur.length&&!ignore)results.push([...cur]);
      let orderRaw=tokens[0],skus=tokens.slice(1);
      if(/-MIX/i.test(orderRaw)){removed.push(orderRaw);ignore=true;cur=[];continue}
      if(/-MM\d*$/i.test(orderRaw)){mmOrders.push(orderRaw);ignore=true;cur=[];continue} // NEW: treat MM like MIX (remove)
      const order=orderRaw.replace(/-MM\d*$/i,""); // clean base if someone pasted w/o catching above
      markMeta(order,metaTokens);
      ignore=false;cur=[order,...skus];
    }else{ // continuation line
      const tok=tokens[0]; const order=(cur[0]||null);
      markMeta(order||null,metaTokens);
      if(ignore||!tok)continue;
      cur.push(tok);
    }
  }
  if(cur.length&&!ignore)results.push([...cur]);

  // Alerts
  renderAlert("mm-alert",{title:"ðŸ—‘ï¸ Removed -MM",items:mmOrders,previewCount:5,copyLabel:"Copy"});
  renderAlert("removed-alert",{title:"ðŸ—‘ï¸ Removed MIX",items:removed,previewCount:5,copyLabel:"Copy"});
  // PLX / PAIR but only 1 SKU (based on meta captured per base order)
  results.forEach(r=>{const order=r[0],skuCount=r.length-1,meta=metaByOrder.get(order)||{plx:false,pair:false};if((meta.plx||meta.pair)&&skuCount<2)pairPlxOne.push(order)});
  renderAlert("pair-plx-alert",{title:"â€¼ï¸PLX/PAIR Orders with Missing SKU",items:pairPlxOne,previewCount:8,copyLabel:"Copy"});

  // Outputs (unchanged)
  const formatted=results.map(r=>r.join("\t")+"\t\t;");lastOrders=results.map(r=>r[0]);
  document.getElementById("output").textContent=formatted.join("\n");
  document.getElementById("ordersOutput").textContent=lastOrders.join("\n");
  document.getElementById("total").textContent="Total Orders: "+results.length;
}
function copyOutput(){const b=document.getElementById("copyFormattedBtn"),o=b.textContent,out=document.getElementById("output"),range=document.createRange(),sel=window.getSelection();range.selectNodeContents(out);sel.removeAllRanges();sel.addRange(range);document.execCommand("copy");sel.removeAllRanges();b.textContent="Copied!";setTimeout(()=>b.textContent=o,500)}
function copyOrders(){const b=document.getElementById("copyOrdersBtn"),o=b.textContent,t=lastOrders.join("\r\n"),ta=document.createElement("textarea");ta.style.position="absolute";ta.style.left="-9999px";ta.value=t;document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta);b.textContent="Copied!";setTimeout(()=>b.textContent=o,500)}
function resetAll(){document.getElementById("input").value="";document.getElementById("output").textContent="";document.getElementById("ordersOutput").textContent="";document.getElementById("total").textContent="Total Orders: 0";["mm-alert","removed-alert","pair-plx-alert"].forEach(id=>{const el=document.getElementById(id);el.style.display="none";el.dataset.visible="false"});lastOrders=[]}
</script>
</body></html>
