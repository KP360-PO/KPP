<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>DIM Calculator</title><meta name="author" content="Christine Anastacio"/><style>
:root{--bg:#fff;--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--card:#fff;--accent:#2563eb;--radius:12px;--shadow:0 1px 2px rgba(0,0,0,.04),0 8px 24px rgba(0,0,0,.06)}
html,body{height:100%}body{margin:0;font:14px/1.45 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--ink)}
.wrap{max-width:980px;margin:28px auto 80px;padding:0 20px}header{margin-bottom:14px}
h1{margin:0;font-size:20px;font-weight:650;letter-spacing:.2px}.sub{color:var(--muted);font-size:12px;margin-top:6px;max-width:860px}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}.spacer{flex:1}.hint{color:var(--muted);font-size:12px}
.btn{appearance:none;border:1px solid var(--line);background:#fff;color:var(--ink);padding:10px 14px;border-radius:10px;font-size:14px;cursor:pointer;transition:filter .16s ease,transform .04s ease}
.btn:hover{filter:brightness(1.03)}.btn:active{transform:translateY(1px)}.btn.primary{border-color:var(--accent);color:#fff;background:var(--accent)}
.inline-ctrl{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--line);border-radius:999px;background:#fff}
.inline-ctrl label{margin:0;font-size:12px;color:var(--muted);white-space:nowrap}
.inline-ctrl select{border:1px solid var(--line);border-radius:999px;padding:7px 10px;background:#fff;font-size:13px;outline:none}
label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
input[type="number"]{width:100%;box-sizing:border-box;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;color:#0f172a;font-size:13px}
input[type="number"]::placeholder{color:#9aa6b2}
.items table{width:100%;border-collapse:separate;border-spacing:0 8px}
.items thead th{padding:0 6px 8px;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;font-weight:650;font-size:11px;border-bottom:1px solid var(--line)}
.items tbody td{padding:8px 6px;background:#fff;border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
.items tbody tr td:first-child{border-left:1px solid var(--line);border-top-left-radius:12px;border-bottom-left-radius:12px}
.items tbody tr td:last-child{border-right:1px solid var(--line);border-top-right-radius:12px;border-bottom-right-radius:12px}
.muted{color:var(--muted)}.remove.btn{padding:9px 12px}
table.results{width:100%;border-collapse:collapse}
table.results th,table.results td{padding:12px 8px;border-bottom:1px solid var(--line);font-size:14px;vertical-align:top}
table.results th{color:var(--muted);text-transform:uppercase;font-size:11px;letter-spacing:.06em}
tr.win{background:rgba(37,99,235,.06)}tr.win td{font-weight:700}
details.viz-det{margin:0}details.viz-det>summary{list-style:none;cursor:pointer;user-select:none;display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:var(--muted)}
details.viz-det>summary::-webkit-details-marker{display:none}details.viz-det[open]>summary{color:#0f172a;background:#f8fafc}
.viz-box{padding:10px 0}.viz-canvas{width:100%;height:220px;display:block;border:1px solid var(--line);border-radius:10px;background:#fff}
.viz-caption{color:var(--muted);font-size:12px;margin-top:6px}
.pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:12px}
#status{font-size:13px;padding:6px 10px;border-radius:999px;background:#fee2e2;color:#b91c1c;font-weight:500;display:inline-flex;align-items:center;gap:6px}
.note{font-size:13px;margin-top:10px;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#f8fafc;color:var(--ink);display:flex;align-items:flex-start;gap:8px;line-height:1.4}
.note::before{content:"üí°";flex:none;margin-top:1px}.note.warn{border-color:#f97316;background:#fffbeb;color:#92400e}.note.warn::before{content:"‚ö†Ô∏è"}
.note.danger{border-color:#ef4444;background:#fef2f2;color:#b91c1c}.note.danger::before{content:"‚õî"}
.splitCard{border:1px solid var(--line);border-radius:12px;background:#fff;padding:12px;margin-top:10px}
.splitHead{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
.merged{font-size:12px;color:var(--muted);line-height:1.35}
.merged b{color:#0f172a}
@media (max-width:820px){.items table{border-spacing:0 10px}}
</style></head><body><div class="wrap"><header><h1>DIM Calculator</h1><div class="sub">Enter item dimensions and quantity. The tool finds the lowest estimated billable weight carton (DIM vs actual), filters cartons that exceed girth limit, and can suggest a split into multiple cartons.</div></header>

<section class="card" aria-label="Items">
  <div class="row" style="justify-content:space-between;margin-bottom:10px">
    <div class="row"><button class="btn primary" id="addItemBtn">+ Add Item</button><button class="btn" id="clearItemsBtn">Clear</button><span id="status" role="status" aria-live="polite" style="display:none"></span></div>
    <span class="hint">All dimensions in inches ‚Ä¢ Weight in pounds</span>
  </div>
  <div class="items" id="itemsWrap"></div>

  <div style="display:none" aria-hidden="true">
    <input id="girthLimit" type="number" min="1" step="0.01" value="105"/>
    <input id="topN" type="number" min="1" step="1" value="8"/>
    <input id="perItemK" type="number" min="1" step="1" value="8"/>
    <input id="beamWidth" type="number" min="1" step="1" value="60"/>
    <select id="useCatalog"><option value="off" selected>Off</option><option value="on">On</option></select>
  </div>
</section>

<section class="card" style="margin-top:14px" aria-label="Results">
  <div class="row" style="justify-content:space-between;align-items:baseline">
    <span id="bestTag" class="pill" style="display:none">Best</span>
    <div id="summary" class="hint"></div>
  </div>
  <div id="suggestion" class="note" style="display:none"></div>

  <div id="splitSection" class="splitCard" style="display:none">
    <div class="splitHead">
      <div class="inline-ctrl" title="Choose how many cartons to split into">
        <label for="splitBoxes">Split into</label>
        <select id="splitBoxes"><option value="1" selected>1 box</option><option value="2">2 boxes</option><option value="3">3 boxes</option><option value="4">4 boxes</option></select>
      </div>
      <div id="splitMeta" class="hint"></div>
    </div>
    <div id="splitWrap"></div>
  </div>

  <div id="results" style="margin-top:10px"></div>
</section>

<div style="margin-top:18px;font-size:11px;color:#94a3b8;text-align:center;">DIM Calculator ‚Ä¢ Created by Christine Anastacio</div>
</div>

<script>
(function(){const $=id=>document.getElementById(id),fmt=n=>Number(n).toLocaleString(undefined,{maximumFractionDigits:2}),permutations=a=>[[a[0],a[1],a[2]],[a[0],a[2],a[1]],[a[1],a[0],a[2]],[a[1],a[2],a[0]],[a[2],a[0],a[1]],[a[2],a[1],a[0]]],DIM_DIVISOR=139,BOX_CATALOG=[{name:"12x12x12",L:12,W:12,H:12},{name:"16x12x12",L:16,W:12,H:12},{name:"18x14x14",L:18,W:14,H:14},{name:"20x16x16",L:20,W:16,H:16},{name:"24x18x18",L:24,W:18,H:18},{name:"24x20x20",L:24,W:20,H:20},{name:"28x20x20",L:28,W:20,H:20},{name:"30x24x24",L:30,W:24,H:24}];
function girthOK(L,W,H,limit){const s=[L,W,H].sort((x,y)=>y-x),g=s[0]+2*(s[1]+s[2]);return{ok:g<=limit,girth:g,length:s[0],other1:s[1],other2:s[2]}}
function billableWeightForBox(L,W,H,actualWeight){const dimWeight=(L*W*H)/DIM_DIVISOR,act=actualWeight||0;return act<=0?dimWeight:Math.max(act,dimWeight)}
function uniqueTriplesForQty(Q){const out=[],seen=new Set(),Qc=Math.max(1,Math.ceil(Q));for(let a=1;a<=Qc;a++){const maxB=Math.ceil(Qc/a);for(let b=a;b<=maxB;b++){const c=Math.ceil(Qc/(a*b)),t=[a,b,Math.max(b,c)].sort((x,y)=>x-y),k=t.join("x");seen.has(k)||(seen.add(k),out.push(t))}}return out}
function buildBlocksForItem(L,W,H,Q,WT,keepK){const triples=uniqueTriplesForQty(Q),orients=permutations([L,W,H]),rows=[],perItemWeight=WT>0?WT:0,totalItemWeight=perItemWeight*Math.max(1,Q);for(const t of triples)for(const o of orients){const dims=[t[0]*o[0],t[1]*o[1],t[2]*o[2]],[L2,W2,H2]=dims.map(x=>+x.toFixed(4));rows.push({L:L2,W:W2,H:H2,sum:L2+W2+H2,weight:totalItemWeight,a:t[0],b:t[1],c:t[2],orient:o.slice()})}const seen=new Set(),dedup=[];for(const r of rows){const key=[r.L,r.W,r.H].map(v=>v.toFixed(4)).sort((a,b)=>Number(a)-Number(b)).join("|");seen.has(key)||(seen.add(key),dedup.push(r))}return dedup.sort((x,y)=>x.sum-y.sum||(x.L*x.W*x.H)-(y.L*y.W*y.H)).slice(0,keepK)}
function combineBlocks(blockLists,beamWidth,girthLimit){let beams=[{L:0,W:0,H:0,sum:0,weight:0,picked:[]}];const axes=["X","Y","Z"];for(let i=0;i<blockLists.length;i++){const next=[];for(const b of beams)for(const blk of blockLists[i])for(const ax of axes){let L=b.L,W=b.W,H=b.H;ax==="X"&&(L=b.L+blk.L,W=Math.max(b.W,blk.W),H=Math.max(b.H,blk.H));ax==="Y"&&(L=Math.max(b.L,blk.L),W=b.W+blk.W,H=Math.max(b.H,blk.H));ax==="Z"&&(L=Math.max(b.L,blk.L),W=Math.max(b.W,blk.W),H=b.H+blk.H);if(!girthOK(L,W,H,girthLimit).ok)continue;const weight=(b.weight||0)+(blk.weight||0),bw=billableWeightForBox(L,W,H,weight);next.push({L,W,H,sum:L+W+H,weight,bw,picked:b.picked.concat([{i,ax,blk}])})}next.sort((x,y)=>x.bw-y.bw||x.sum-y.sum||(x.L*x.W*x.H)-(y.L*y.W*y.H));beams=next.slice(0,beamWidth);if(!beams.length)break}return beams.sort((x,y)=>x.bw-y.bw||x.sum-y.sum||(x.L*x.W*x.H)-(y.L*y.W*y.H))}
function dedupeBoxes(list){const out=[],seen=new Set();for(const r of list){const key=[r.L,r.W,r.H].map(v=>v.toFixed(4)).sort((a,b)=>Number(a)-Number(b)).join("|");seen.has(key)||(seen.add(key),out.push(r))}return out}
function applyCatalogFilter(candidates,girthLimit){const key=(L,W,H)=>[L,W,H].sort((a,b)=>a-b).map(v=>v.toFixed(4)).join("|"),allowed=new Set(BOX_CATALOG.filter(b=>girthOK(b.L,b.W,b.H,girthLimit).ok).map(b=>key(b.L,b.W,b.H)));return candidates.filter(r=>allowed.has(key(r.L,r.W,r.H)))}
function bestForGroup(items,keepK,beamWidth,girthLimit,useCatalog){const blockLists=items.map(({L,W,H,Q,WT})=>buildBlocksForItem(L,W,H,Q,WT,keepK));let candidates=combineBlocks(blockLists,beamWidth,girthLimit);candidates=dedupeBoxes(candidates);useCatalog&&(candidates=applyCatalogFilter(candidates,girthLimit));return candidates.length?candidates[0]:null}
function itemScore(it){const vol=it.L*it.W*it.H*Math.max(1,it.Q||1),wt=(it.WT||0)*Math.max(1,it.Q||1);return vol+500*wt}
function splitIntoN(items,n){const groups=Array.from({length:n},()=>({items:[],score:0})),sorted=items.slice().sort((a,b)=>itemScore(b)-itemScore(a));for(const it of sorted){groups.sort((a,b)=>a.score-b.score);groups[0].items.push(it);groups[0].score+=itemScore(it)}return groups.map(g=>g.items).filter(g=>g.length)}
function renderSplitPlan(plans,totalBillable){$("splitSection").style.display="";$("splitMeta").textContent=`Suggested split cartons ‚Ä¢ Est. total billable wt ${fmt(totalBillable)} lb`;const mergedHtml=p=>{const items=p.items||[],picked=Array.isArray(p.best.picked)?p.best.picked:[];if(!picked.length)return'<span class="muted">‚Äî</span>';return`<div class="merged">${picked.map((x,idx)=>{const it=items[x.i]||{};const orig=(it.L&&it.W&&it.H)?`${fmt(it.L)}√ó${fmt(it.W)}√ó${fmt(it.H)} (qty ${it.Q||1}${(!Number.isNaN(it.WT)&&it.WT>=0)?`, wt ${fmt(it.WT)}lb ea`:""})`:`Item ${idx+1}`;return`<div style="margin:2px 0"><span class="muted">‚Ä¢</span> <b>${orig}</b></div>`}).join("")}</div>`};$("splitWrap").innerHTML=`<table class="results"><thead><tr><th>Box</th><th>Carton (L √ó W √ó H)</th><th>L + W + H</th><th>Weight (Actual / Billable lb)</th><th>Merged items</th></tr></thead><tbody>${plans.map((p,i)=>`<tr><td>Box ${i+1}</td><td>${fmt(p.best.L)} √ó ${fmt(p.best.W)} √ó ${fmt(p.best.H)} in</td><td>${fmt(p.best.sum)}</td><td>${fmt(p.best.weight||0)} / ${fmt(p.bw)}</td><td>${mergedHtml(p)}</td></tr>`).join("")}</tbody></table>`}
function clearSplitPlan(){$("splitSection").style.display="none";$("splitMeta").textContent="";$("splitWrap").innerHTML=""}
function renderItemsTable(){$("itemsWrap").innerHTML=`<table id="itemsTable"><thead><tr><th style="width:44px">#</th><th>Length</th><th>Width</th><th>Height</th><th>Qty</th><th>Weight</th><th style="width:86px"></th></tr></thead><tbody id="itemsTbody"></tbody></table>`}
function addItemRow(vals={}){const tb=$("itemsTbody"),idx=tb.children.length+1,tr=document.createElement("tr");tr.innerHTML=`<td class="muted">${idx}</td><td><input type="number" step="0.01" min="0.01" value="${vals.L??""}" placeholder="Length"></td><td><input type="number" step="0.01" min="0.01" value="${vals.W??""}" placeholder="Width"></td><td><input type="number" step="0.01" min="0.01" value="${vals.H??""}" placeholder="Height"></td><td><input type="number" step="1" min="1" value="${vals.Q??1}" placeholder="Qty"></td><td><input type="number" step="0.01" min="0" value="${vals.WT??""}" placeholder="Weight (lb)"></td><td><button class="btn remove" title="Remove row">Remove</button></td>`;tb.appendChild(tr);tr.querySelector(".remove").addEventListener("click",()=>{tr.remove();[...tb.children].forEach((r,i)=>r.children[0].textContent=String(i+1));compute()})}
function getItems(){return[...document.querySelectorAll("#itemsTbody tr")].map(r=>{const [L,W,H,Q,WT]=[...r.querySelectorAll("input")].map(i=>parseFloat(i.value));return{L,W,H,Q,WT}}).filter(x=>!Number.isNaN(x.L)||!Number.isNaN(x.W)||!Number.isNaN(x.H)||!Number.isNaN(x.Q)||!Number.isNaN(x.WT))}
function validateItems(items){if(!items.length)return"Add at least one item.";for(let i=0;i<items.length;i++){const {L,W,H,Q,WT}=items[i];if(!(L>0&&W>0&&H>0))return`Line ${i+1}: enter positive L/W/H.`;if(!(Q>=1))return`Line ${i+1}: Qty must be at least 1.`;if(L>1e4||W>1e4||H>1e4)return`Line ${i+1}: dimensions look too large (inches).`;if(!Number.isNaN(WT)&&WT<0)return`Line ${i+1}: Weight cannot be negative.`}return""}
function drawIsometric(canvas,L,W,H){const ctx=canvas.getContext("2d"),dpr=window.devicePixelRatio||1,cssW=canvas.clientWidth,cssH=canvas.clientHeight;canvas.width=Math.max(1,Math.floor(cssW*dpr));canvas.height=Math.max(1,Math.floor(cssH*dpr));ctx.setTransform(dpr,0,0,dpr,0,0);ctx.clearRect(0,0,cssW,cssH);if(!(L>0&&W>0&&H>0))return;const pad=16,drawW=cssW-2*pad,drawH=cssH-2*pad,ax=Math.cos(Math.PI/6),ay=Math.sin(Math.PI/6),maxX=L*ax+W*ax,maxY=H+L*ay+W*ay,scale=Math.min(drawW/(maxX||1),drawH/(maxY||1)),offsetX=pad+(drawW-maxX*scale)/2,offsetY=pad+(drawH-maxY*scale)/2,P=(x,y,z)=>({x:offsetX+(x*ax-y*ax)*scale,y:offsetY+(z+x*ay+y*ay)*scale}),A=P(0,0,0),B=P(L,0,0),C=P(L,W,0),D=P(0,W,0),A2=P(0,0,H),B2=P(L,0,H),C2=P(L,W,H),D2=P(0,W,H),line=(p,q,stroke="#0f172a",w=1)=>{ctx.strokeStyle=stroke;ctx.lineWidth=w;ctx.beginPath();ctx.moveTo(p.x,p.y);ctx.lineTo(q.x,q.y);ctx.stroke()},poly=(pts,fill,stroke,w=1)=>{ctx.beginPath();ctx.moveTo(pts[0].x,pts[0].y);for(let i=1;i<pts.length;i++)ctx.lineTo(pts[i].x,pts[i].y);ctx.closePath();fill&&(ctx.fillStyle=fill,ctx.fill());stroke&&(ctx.strokeStyle=stroke,ctx.lineWidth=w,ctx.stroke())},text=(s,x,y,c="#64748b",size=12,align="center")=>{ctx.fillStyle=c;ctx.font=`${size}px ui-sans-serif, system-ui`;ctx.textAlign=align;ctx.textBaseline="middle";ctx.fillText(s,x,y)};
poly([A2,B2,C2,D2],"rgba(99,102,241,0.06)","#e2e8f0",1);poly([B,B2,C2,C],"rgba(14,165,233,0.06)","#e2e8f0",1);poly([A,A2,D2,D],"rgba(16,185,129,0.06)","#e2e8f0",1);
[[A,B],[B,C],[C,D],[D,A],[A,A2],[B,B2],[C,C2],[D,D2],[A2,B2],[B2,C2],[C2,D2],[D2,A2]].forEach(seg=>line(seg[0],seg[1],"#0f172a",1));
const arrow=(p,q,color="#2563eb")=>{line(p,q,color,1.6);const ang=Math.atan2(q.y-p.y,q.x-p.x),ah=8,t1={x:q.x-Math.cos(ang)*ah+Math.sin(ang)*ah,y:q.y-Math.sin(ang)*ah-Math.cos(ang)*ah},t2={x:q.x-Math.cos(ang)*ah-Math.sin(ang)*ah,y:q.y-Math.sin(ang)*ah+Math.cos(ang)*ah};line(q,t1,color,1.6);line(q,t2,color,1.6)};
arrow(A,B);text(`L ${fmt(L)} in`,(A.x+B.x)/2,(A.y+B.y)/2-10,"#2563eb");arrow(B,C);text(`W ${fmt(W)} in`,(B.x+C.x)/2+10,(B.y+C.y)/2+2,"#2563eb",12,"left");arrow(B,B2);text(`H ${fmt(H)} in`,B.x+10,(B.y+B2.y)/2,"#2563eb",12,"left")}
function renderTable(rows,topN,girthLimit){const el=$("results");if(!rows||!rows.length){el.innerHTML="";$("bestTag").style.display="none";$("summary").textContent="";return}const n=Math.min(topN,rows.length);let html=`<table class="results"><thead><tr><th>#</th><th>Carton (L √ó W √ó H)</th><th>L + W + H</th><th>Length + 2√ó(W+H)</th><th>Weight (Actual / Billable lb)</th><th>3D</th></tr></thead><tbody>`;for(let i=0;i<n;i++){const r=rows[i],g=girthOK(r.L,r.W,r.H,girthLimit),rowId=`r${i}`,actualWt=r.weight?fmt(r.weight):"‚Äî",billableWt=fmt(r.bw||billableWeightForBox(r.L,r.W,r.H,r.weight));html+=`<tr ${i===0?'class="win"':""}><td>${i+1}</td><td>${fmt(r.L)} √ó ${fmt(r.W)} √ó ${fmt(r.H)} in</td><td>${fmt(r.sum)}</td><td>${fmt(g.girth)} / ${fmt(girthLimit)}</td><td>${actualWt} / ${billableWt}</td><td><details class="viz-det" data-l="${r.L}" data-w="${r.W}" data-h="${r.H}"><summary>3D view</summary><div class="viz-box"><canvas class="viz-canvas" id="cv-${rowId}"></canvas><div class="viz-caption">Isometric view of this carton</div></div></details></td></tr>`}html+="</tbody></table>";$("bestTag").style.display="";el.innerHTML=html;const allDetails=[...el.querySelectorAll("details.viz-det")];allDetails.forEach(det=>{det.addEventListener("toggle",()=>{if(det.open){const L=parseFloat(det.dataset.l),W=parseFloat(det.dataset.w),H=parseFloat(det.dataset.h),canvas=det.querySelector("canvas.viz-canvas");drawIsometric(canvas,L,W,H)}})});const redrawOpen=()=>{allDetails.forEach(det=>{if(det.open){const L=parseFloat(det.dataset.l),W=parseFloat(det.dataset.w),H=parseFloat(det.dataset.h),canvas=det.querySelector("canvas.viz-canvas");drawIsometric(canvas,L,W,H)}})};window.__dimVizResize&&window.removeEventListener("resize",window.__dimVizResize);window.__dimVizResize=redrawOpen;window.addEventListener("resize",redrawOpen)}
function setStatus(msg){const s=$("status");msg?(s.style.display="",s.textContent=msg):(s.style.display="none",s.textContent="")}
function setSuggestion(text,cls){const s=$("suggestion");text?(s.textContent=text,s.className="note "+(cls||""),s.style.display=""):(s.style.display="none",s.textContent="",s.className="note")}
function compute(){setStatus("");clearSplitPlan();const items=getItems(),err=validateItems(items),girthLimit=parseFloat($("girthLimit").value)||105,keepK=Math.max(1,parseInt($("perItemK").value,10)||8),beamWidth=Math.max(1,parseInt($("beamWidth").value,10)||60),topN=Math.max(1,parseInt($("topN").value,10)||8),useCatalog=$("useCatalog")&&$("useCatalog").value==="on",splitN=parseInt(($("splitBoxes")&&$("splitBoxes").value)||"1",10)||1;if(err){$("summary").textContent="";$("results").innerHTML="";$("bestTag").style.display="none";setSuggestion("");setStatus(err);return}const t0=performance.now(),blockLists=items.map(({L,W,H,Q,WT})=>buildBlocksForItem(L,W,H,Q,WT,keepK));let candidates=combineBlocks(blockLists,beamWidth,girthLimit);candidates=dedupeBoxes(candidates);useCatalog&&(candidates=applyCatalogFilter(candidates,girthLimit));const t1=performance.now();
if(!candidates.length){$("summary").textContent="";$("results").innerHTML="";$("bestTag").style.display="none";setSuggestion("No single carton fits ‚Äî showing split cartons instead.","danger");const wantN=Math.max(2,splitN),groups=splitIntoN(items,wantN),plans=[];let ok=!0,totalBillable=0;for(const grp of groups){const b=bestForGroup(grp,keepK,beamWidth,girthLimit,useCatalog);if(!b){ok=!1;break}const bw=b.bw||billableWeightForBox(b.L,b.W,b.H,b.weight);plans.push({best:b,bw,items:grp});totalBillable+=bw}if(!ok){setStatus(`No solution even after splitting into ${wantN} boxes.`);setSuggestion("Try increasing Split into, turning OFF catalog, or adjusting girth limit.","danger");return}$("bestTag").style.display="";$("summary").textContent=`Split plan (${wantN} boxes) ‚Ä¢ Est. total billable wt ${fmt(totalBillable)} lb ‚Ä¢ ${fmt(t1-t0)} ms`;renderSplitPlan(plans,totalBillable);return}
const best=candidates[0],bestBillable=best.bw||billableWeightForBox(best.L,best.W,best.H,best.weight),bestActual=best.weight||0;$("summary").textContent=`Best: ${fmt(best.L)} √ó ${fmt(best.W)} √ó ${fmt(best.H)} in ‚Ä¢ L+W+H ${fmt(best.sum)} ‚Ä¢ Actual wt ${fmt(bestActual)} lb ‚Ä¢ Est. billable wt ${fmt(bestBillable)} lb ‚Ä¢ ${fmt(t1-t0)} ms`;renderTable(candidates,topN,girthLimit);
const g=girthOK(best.L,best.W,best.H,girthLimit),nearLimit=g.girth>=girthLimit-5,shouldShowSplit=splitN>1||nearLimit;nearLimit?setSuggestion("Tip: this carton is near the girth limit ‚Äî showing suggested split cartons below.","warn"):splitN>1?setSuggestion("Showing suggested split cartons below (because Split into > 1).","warn"):setSuggestion("");
if(shouldShowSplit){const wantN=Math.max(2,splitN||2),groups=splitIntoN(items,wantN),plans=[];let ok=!0,totalBillable=0;for(const grp of groups){const b=bestForGroup(grp,keepK,beamWidth,girthLimit,useCatalog);if(!b){ok=!1;break}const bw=b.bw||billableWeightForBox(b.L,b.W,b.H,b.weight);plans.push({best:b,bw,items:grp});totalBillable+=bw}ok?renderSplitPlan(plans,totalBillable):(clearSplitPlan(),splitN>1&&setSuggestion("Split selected, but no valid split cartons found under current limits.","warn"))}}
renderItemsTable();addItemRow({});compute();
$("addItemBtn").addEventListener("click",()=>{addItemRow({});compute()});
$("clearItemsBtn").addEventListener("click",()=>{$("itemsTbody").innerHTML="";addItemRow({});compute()});
let t=null;document.addEventListener("input",e=>{if(e.target.closest("#itemsWrap")||e.target.id==="splitBoxes"||e.target.id==="useCatalog"){clearTimeout(t);t=setTimeout(compute,120)}});
["splitBoxes","useCatalog"].forEach(id=>{const el=$(id);el&&el.addEventListener("change",compute)});
})();
</script></body></html>
